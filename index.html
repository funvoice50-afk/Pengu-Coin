<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bee Token - Meme Coin Project</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', sans-serif;
        }
        
        :root {
            --primary-yellow: #FFD700;
            --secondary-yellow: #FFEE58;
            --dark-yellow: #F9A825;
            --black: #1A1A1A;
            --white: #FFFFFF;
            --gray: #F5F5F5;
            --green: #4CAF50;
            --red: #F44336;
            --blue: #2196F3;
        }
        
        body {
            background-color: var(--primary-yellow);
            background-image: radial-gradient(circle at 20% 80%, var(--secondary-yellow) 0%, transparent 20%),
                              radial-gradient(circle at 80% 20%, var(--secondary-yellow) 0%, transparent 20%),
                              radial-gradient(circle at 40% 40%, #FFF59D 0%, transparent 30%);
            color: var(--black);
            min-height: 10vh;
            padding-bottom: 80px;
        }
        
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .app-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M20,50 Q50,20 80,50 Q50,80 20,50 Z" fill="none" stroke="%23FFD700" stroke-width="1" opacity="0.1"/></svg>');
            background-size: 200px;
            opacity: 0.3;
            z-index: 0;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary-yellow), var(--dark-yellow));
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
            border-bottom: 5px dashed var(--black);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 36px;
            color: var(--black);
        }
        
        .logo h1 {
            font-size: 32px;
            color: var(--black);
            text-shadow: 2px 2px 0 var(--white);
        }
        
        .bee-subtitle {
            font-size: 14px;
            color: var(--black);
            background-color: var(--white);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid var(--black);
        }
        
        .content-area {
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .stats-bar {
            background-color: var(--white);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid var(--black);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--black);
        }
        
        .bee-value {
            color: var(--dark-yellow);
        }
        
        .usd-value {
            color: var(--green);
        }
        
        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dotted var(--primary-yellow);
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--dark-yellow);
        }
        
        .card {
            background-color: var(--white);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 3px solid var(--black);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(to right, var(--primary-yellow), var(--dark-yellow));
        }
        
        .button {
            background: linear-gradient(to bottom, var(--primary-yellow), var(--dark-yellow));
            color: var(--black);
            border: 3px solid var(--black);
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 5px 0 var(--black);
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 var(--black);
        }
        
        .button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 var(--black);
        }
        
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 5px 0 var(--black);
        }
        
        .button-primary {
            background: linear-gradient(to bottom, var(--primary-yellow), var(--dark-yellow));
        }
        
        .button-secondary {
            background: linear-gradient(to bottom, #4CAF50, #2E7D32);
            color: white;
        }
        
        .button-small {
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .info-text {
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            color: #666;
        }
        
        .countdown {
            font-size: 14px;
            color: var(--red);
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
        
        /* Removed ad-container and ad-placeholder styles */
        
        .task-list {
            list-style-type: none;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background-color: var(--gray);
            border-radius: 15px;
            margin-bottom: 10px;
            border: 2px solid var(--black);
            cursor: pointer; /* Added cursor for clickability */
        }
        
        .task-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .task-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--black);
        }
        
        .task-details h4 {
            margin-bottom: 5px;
        }
        
        .task-details p {
            font-size: 12px;
            color: #666;
        }
        
        .reward-badge {
            background-color: var(--dark-yellow);
            color: var(--black);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            border: 2px solid var(--black);
        }
        
        .trade-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: var(--gray);
            border-radius: 15px;
            border: 2px solid var(--black);
        }
        
        .trade-rate {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-yellow);
            margin: 10px 0;
        }
        
        .profile-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .profile-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background-color: var(--gray);
            border-radius: 15px;
            border: 2px solid var(--black);
        }
        
        .profile-label {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coming-soon {
            background-color: var(--red);
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 5px solid var(--black);
            z-index: 100;
            max-width: 500px;
            margin: 0 auto;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            background-color: var(--primary-yellow);
            transform: translateY(-10px);
            box-shadow: 0 -5px 0 var(--black);
        }
        
        .nav-icon {
            font-size: 24px;
            color: var(--black);
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: bold;
            color: var(--black);
        }
        
        .honeycomb-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,0 L93.3,25 L93.3,75 L50,100 L6.7,75 L6.7,25 Z" fill="none" stroke="%23FFD700" stroke-width="2" opacity="0.1"/></svg>');
            background-size: 100px;
            z-index: 0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--green);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            border: 3px solid var(--black);
            max-width: 300px;
            animation: slideIn 0.5s;
        }

        .profile-pic-container {
            width: 80px; 
            height: 80px; 
            background: linear-gradient(to bottom, var(--primary-yellow), var(--dark-yellow)); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 0 auto 15px; 
            border: 3px solid var(--black); 
            overflow: hidden;
            /* Added for removal */
            display: none; 
        }

        .profile-pic-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Referral Section Styles */
        .referral-section {
            background: linear-gradient(135deg, var(--primary-yellow), var(--dark-yellow));
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 3px solid var(--black);
        }
        
        .referral-code {
            background-color: var(--white);
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 3px;
            border: 3px solid var(--black);
        }
        
        .referral-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .referral-stat {
            text-align: center;
        }
        
        .referral-number {
            font-size: 28px;
            font-weight: bold;
            color: var(--black);
        }
        
        .referral-label {
            font-size: 12px;
            color: #333;
        }
        
        /* Authentication Styles */
        .auth-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .auth-box {
            background-color: var(--white);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 5px solid var(--dark-yellow);
        }
        
        .auth-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 3px solid var(--black);
            font-size: 16px;
        }
        
        .auth-button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(to bottom, var(--primary-yellow), var(--dark-yellow));
            border: 3px solid var(--black);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .auth-links {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .auth-link {
            color: var(--dark-yellow);
            text-decoration: underline;
            cursor: pointer;
        }

        /* Withdrawal form styles */
        .withdrawal-form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .withdrawal-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .withdrawal-form-group select,
        .withdrawal-form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid var(--black);
            font-size: 16px;
            background-color: var(--gray);
        }

        .withdrawal-result {
            padding: 10px;
            background-color: var(--secondary-yellow);
            border-radius: 10px;
            border: 2px solid var(--black);
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .withdrawal-warning {
            background-color: var(--red);
            color: var(--white);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 500px) {
            .app-container {
                border-radius: 0;
            }
            
            .nav-bar {
                border-radius: 0;
            }
        }

        /* --- SPLASH SCREEN STYLES --- */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-yellow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            text-align: center;
            background-image: linear-gradient(to top, var(--dark-yellow), var(--primary-yellow));
        }

        .splash-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .splash-logo i {
            font-size: 80px;
            color: var(--black);
            animation: pulse 1.5s infinite alternate;
        }

        .splash-logo h1 {
            font-size: 50px;
            color: var(--black);
            text-shadow: 4px 4px 0 var(--white);
        }

        .splash-message {
            font-size: 20px;
            font-weight: bold;
            color: var(--black);
            margin-bottom: 20px;
        }

        .loading-bar-container {
            width: 80%;
            max-width: 300px;
            height: 15px;
            background-color: var(--white);
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid var(--black);
        }

        #loading-bar {
            height: 100%;
            width: 0%;
            background: var(--dark-yellow);
            animation: load 5s linear forwards;
        }
        
        .loading-text {
            font-size: 14px;
            margin-top: 10px;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        @keyframes load {
            from { width: 0%; }
            to { width: 100%; }
        }
        /* --- END SPLASH SCREEN STYLES --- */
        
        /* --- TELEGRAM ENFORCEMENT MODAL STYLES (NEW) --- */
        #telegram-enforcement-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 3000; /* Higher than auth */
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 5px solid var(--primary-yellow);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .modal-content h2 {
            color: var(--dark-yellow);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .modal-content p {
            margin-bottom: 25px;
            font-size: 16px;
            color: var(--black);
            font-weight: bold;
        }

        .modal-content .button {
            margin-top: 0;
            background: linear-gradient(to bottom, #2196F3, #1976D2); /* Blue for Telegram */
            color: var(--white);
            box-shadow: 0 5px 0 #1976D2;
        }
        
        .modal-content .button:hover {
            box-shadow: 0 8px 0 #1976D2;
        }
        
        .modal-content .button:active {
            box-shadow: 0 3px 0 #1976D2;
        }
        /* --- END MODAL STYLES --- */
    </style>
</head>
<body>
    <div id="auth-container" class="auth-container">
        <div class="auth-box">
            <h2 style="margin-bottom: 20px; color: var(--black);">üêù Bee Token Authentication</h2>
            <div id="login-view">
                <input type="email" id="login-email" class="auth-input" placeholder="Email Address">
                <input type="password" id="login-password" class="auth-input" placeholder="Password">
                <button id="login-btn" class="auth-button">Login</button>
                <div class="auth-links">
                    <span class="auth-link" id="show-signup">Create Account</span>
                    <span class="auth-link" id="skip-auth">Skip for now</span>
                </div>
            </div>
            <div id="signup-view" style="display: none;">
                <input type="text" id="signup-name" class="auth-input" placeholder="Full Name">
                <input type="email" id="signup-email" class="auth-input" placeholder="Email Address">
                <input type="password" id="signup-password" class="auth-input" placeholder="Password">
                <input type="text" id="referral-code-input" class="auth-input" placeholder="Referral Code (Optional)">
                <button id="signup-btn" class="auth-button">Create Account</button>
                <div class="auth-links">
                    <span class="auth-link" id="show-login">Already have account?</span>
                </div>
            </div>
        </div>
    </div>
    
    <div id="telegram-enforcement-modal">
        <div class="modal-content">
            <h2><i class="fab fa-telegram-plane"></i> Important Step!</h2>
            <p>To finalize your account setup and start earning, you must open our Telegram Mini App.</p>
            <button class="button" id="open-telegram-bot-btn">
                <i class="fab fa-telegram"></i> OPEN OUR TELEGRAM MINI APP
            </button>
        </div>
    </div>
    <div id="splash-screen">
        <div class="splash-logo">
            <i class="fas fa-bee"></i>
            <h1>Bee Token</h1>
        </div>
        <p class="splash-message">Buzzing into the Crypto World!</p>
        <div class="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
        <p class="loading-text">Fetching the freshest Honeycomb data...</p>
    </div>
    
    <div class="app-container" style="display:none;">
        <div class="honeycomb-bg"></div>
        
        <div class="header">
            <div class="logo">
                <i class="fas fa-bee"></i>
                <h1>Bee Token</h1>
            </div>
            <div class="bee-subtitle">Buzz for Crypto!</div>
        </div>
        
        <div class="content-area">
            <div class="page active" id="home-page">
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-label">Bee Tokens</div>
                        <div class="stat-value bee-value" id="token-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">USDT Value</div>
                        <div class="stat-value usd-value" id="usdt-value">$0.00</div>
                    </div>
                </div>
                
                <h2 class="section-title"><i class="fas fa-home"></i> Home</h2>
                
                <div class="referral-section">
                    <h3>Invite Friends & Earn More!</h3>
                    <p>Share your referral link and earn 10% of their earnings!</p>
                    <div class="referral-code" id="referral-code-display">Loading...</div>
                    <button class="button" id="copy-referral-btn">
                        <i class="fas fa-copy"></i> Copy Referral Link
                    </button>
                    <div class="referral-stats">
                        <div class="referral-stat">
                            <div class="referral-number" id="total-referrals">0</div>
                            <div class="referral-label">Total Referrals</div>
                        </div>
                        <div class="referral-stat">
                            <div class="referral-number" id="referral-earnings">0</div>
                            <div class="referral-label">Earned from Referrals</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;">üëÜ Daily Bee Tap üëÜ</h3>
                    <p style="text-align: center; margin-bottom: 20px;">Tap to claim your daily <strong>50 Bee Tokens</strong>!</p>
                    
                    <button class="button button-primary" id="claim-airdrop" style="margin-top: 20px;">
                        <i class="fas fa-hand-point-up"></i> Tap for 50 Bee Tokens
                    </button>
                    
                    <div class="info-text" id="airdrop-info">You can tap again in: <span id="airdrop-countdown">24:00:00</span></div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;"><i class="fas fa-chart-line"></i> Quick Stats</h3>
                    <div style="display: flex; justify-content: space-around; text-align: center;">
                        <div>
                            <div style="font-size: 12px; color: #666;">Today's Ads</div>
                            <div style="font-size: 20px; font-weight: bold;" id="today-ads">0/100</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #666;">Tasks Completed</div>
                            <div style="font-size: 20px; font-weight: bold;" id="tasks-completed">0/3</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page" id="earn-page">
                <h2 class="section-title"><i class="fas fa-coins"></i> Earn Tokens</h2>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;">Watch Ads & Earn</h3>
                    <p style="text-align: center; margin-bottom: 15px;">Watch up to <strong>100 ads per day</strong> (50 per hour). Each ad gives you <strong>10 Bee Tokens</strong>.</p>
                    
                    <div id="current-ad" style="text-align: center; margin-bottom: 20px; padding: 20px; background-color: var(--gray); border-radius: 10px; border: 2px dashed var(--black);">
                         <i class="fas fa-video" style="font-size: 40px; color: var(--blue);"></i>
                         <p style="margin-top: 10px;">Ready to watch an ad!</p>
                         <p id="ad-timer" style="font-size: 12px; margin-top: 5px;"></p>
                    </div>
                    
                    <button class="button button-primary" id="watch-ad">
                        <i class="fas fa-play-circle"></i> Watch Ad & Earn 10 Tokens
                    </button>
                    
                    <div class="info-text">
                        Ads Watched Today: <span id="ads-watched">0</span>/100 ‚Ä¢ 
                        Next ad in: <span id="ad-countdown">0s</span>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;"><i class="fas fa-trophy"></i> Daily Progress</h3>
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ad Watching Progress</span>
                            <span id="ad-progress">0%</span>
                        </div>
                        <div style="height: 15px; background-color: #eee; border-radius: 10px; overflow: hidden; border: 2px solid var(--black);">
                            <div id="ad-progress-bar" style="height: 100%; width: 0%; background: linear-gradient(to right, var(--primary-yellow), var(--dark-yellow));"></div>
                        </div>
                    </div>
                    <p style="text-align: center; font-size: 14px; margin-top: 15px;">Complete your daily ads to maximize earnings!</p>
                </div>
            </div>
            
            <div class="page" id="task-page">
                <h2 class="section-title"><i class="fas fa-tasks"></i> Complete Tasks</h2>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;">Join Channels & Earn</h3>
                    <p style="text-align: center; margin-bottom: 20px;">Click each task to open the link and claim the reward on first click.</p>
                    
                    <ul class="task-list">
                        <li class="task-item" id="task-1">
                            <div class="task-info">
                                <div class="task-icon">
                                    <i class="fab fa-telegram"></i>
                                </div>
                                <div class="task-details">
                                    <h4>Official Telegram Channel</h4>
                                    <p id="telegram-link-text">Click to join our official Telegram</p>
                                </div>
                            </div>
                            <div class="reward-badge">+50 Tokens</div>
                        </li>
                        
                        <li class="task-item" id="task-2">
                            <div class="task-info">
                                <div class="task-icon">
                                    <i class="fab fa-youtube"></i>
                                </div>
                                <div class="task-details">
                                    <h4>Official YouTube Channel</h4>
                                    <p id="youtube-link-text">Click to subscribe to our YouTube channel</p>
                                </div>
                            </div>
                            <div class="reward-badge">+50 Tokens</div>
                        </li>

                        <li class="task-item" id="task-3">
                            <div class="task-info">
                                <div class="task-icon">
                                    <i class="fab fa-telegram-plane"></i>
                                </div>
                                <div class="task-details">
                                    <h4>Work in Telegram Bot</h4>
                                    <p id="bot-link-text">Click to start using the Telegram Bot</p>
                                </div>
                            </div>
                            <div class="reward-badge">+200 Tokens</div>
                        </li>
                        </ul>
                    
                    </div>
                
                <div class="info-text">
                    <p><strong>Note:</strong> Rewards are automatically claimed on first click. Total Tasks: <span id="total-available-tasks">3</span></p>
                </div>
            </div>
            
            <div class="page" id="trade-page">
                <h2 class="section-title"><i class="fas fa-exchange-alt"></i> Trade Tokens</h2>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;">Convert Bee Tokens to USDT</h3>
                    
                    <div class="trade-info">
                        <p>Current Exchange Rate</p>
                        <div class="trade-rate">1 BEE = 0.001 USDT</div>
                        <p>Swap your Bee Tokens for USDT instantly</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <label for="bee-amount" style="font-weight: bold;">Bee Tokens to Convert:</label>
                            <span>Balance: <span id="bee-balance-trade">0</span> BEE</span>
                        </div>
                        <input type="number" id="bee-amount" min="0" max="1000000" step="1" value="0" style="width: 100%; padding: 15px; border-radius: 10px; border: 3px solid var(--black); font-size: 18px; text-align: center;">
                        <div style="display: flex; justify-content: center; margin-top: 10px; gap: 10px;">
                            <button class="button button-small" id="btn-25">25%</button>
                            <button class="button button-small" id="btn-50">50%</button>
                            <button class="button button-small" id="btn-75">75%</button>
                            <button class="button button-small" id="btn-100">100%</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <i class="fas fa-arrow-down" style="font-size: 24px; color: var(--dark-yellow);"></i>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <label style="font-weight: bold;">You Will Receive:</label>
                        </div>
                        <div style="padding: 15px; background-color: var(--gray); border-radius: 10px; border: 3px solid var(--black); text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--green);" id="usdt-receive">0.000 USDT</div>
                        </div>
                    </div>
                    
                    <button class="button button-secondary" id="convert-tokens">
                        <i class="fas fa-exchange-alt"></i> Convert Bee to USDT
                    </button>
                </div>
                
                <div class="info-text">
                    <p><strong>Note:</strong> Conversion rate is fixed at 0.001 USDT per Bee Token. Minimum conversion amount is 100 Bee Tokens.</p>
                </div>
            </div>
            
            <div class="page" id="profile-page">
                <h2 class="section-title"><i class="fas fa-user"></i> Profile</h2>
                
                <div class="card">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 id="profile-user-name">Guest Bee</h3>
                        </div>
                    
                    <div class="profile-details">
                        <div class="profile-item">
                            <div class="profile-label">
                                <i class="fas fa-coins" style="color: var(--dark-yellow);"></i>
                                <span>Bee Token Balance</span>
                            </div>
                            <div class="stat-value bee-value" id="profile-bee">0</div>
                        </div>
                        
                        <div class="profile-item">
                            <div class="profile-label">
                                <i class="fas fa-dollar-sign" style="color: var(--green);"></i>
                                <span>USDT Balance</span>
                            </div>
                            <div class="stat-value usd-value" id="profile-usdt">$0.00</div>
                        </div>
                        
                        <div class="profile-item">
                            <div class="profile-label">
                                <i class="fas fa-ad" style="color: var(--blue);"></i>
                                <span>Total Ads Watched</span>
                            </div>
                            <div id="total-ads">0</div>
                        </div>
                        
                        <div class="profile-item">
                            <div class="profile-label">
                                <i class="fas fa-tasks" style="color: var(--red);"></i>
                                <span>Tasks Completed</span>
                            </div>
                            <div id="total-tasks">0</div>
                        </div>
                        
                        <div class="profile-item">
                            <div class="profile-label">
                                <i class="fas fa-users" style="color: var(--primary-yellow);"></i>
                                <span>Total Referrals</span>
                            </div>
                            <div id="profile-referrals">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; text-align: center;">Withdraw Funds</h3>
                    
                    <div id="withdrawal-referral-warning" class="withdrawal-warning" style="display: none;">
                        <p>‚ö†Ô∏è **Withdrawal Lock** ‚ö†Ô∏è</p>
                        <p>You need **15 Referrals** to unlock the **Withdraw** button. You currently have: <span id="current-referrals-count">0</span></p>
                    </div>
                    
                    <div class="info-text" style="color: var(--red); font-weight: bold;">
                        <p>Minimum Withdrawal: 10 USDT</p>
                    </div>

                    <div class="withdrawal-form-group">
                        <label for="withdrawal-amount">USDT Amount (Min. 10):</label>
                        <input type="number" id="withdrawal-amount" min="10" step="0.01" value="10" required>
                    </div>

                    <div class="withdrawal-form-group">
                        <label for="withdrawal-method">Withdrawal Method:</label>
                        <select id="withdrawal-method">
                            <option value="Binance">Binance (USDT)</option>
                            <option value="bKash">bKash (BDT)</option>
                            <option value="Nagad">Nagad (BDT)</option>
                            <option value="PayPal">PayPal (INR)</option>
                        </select>
                    </div>
                    
                    <div class="withdrawal-form-group">
                        <label for="account-details">Account Number/ID:</label>
                        <input type="text" id="account-details" placeholder="Enter your account details" required>
                    </div>

                    <div class="withdrawal-result">
                        You will receive: <span id="receive-amount">10.00 USDT</span>
                    </div>

                    <button class="button button-primary" id="withdraw-button">
                        <i class="fas fa-wallet"></i> Submit Withdrawal Request
                    </button>
                    
                    <div class="info-text" style="margin-top: 15px;">
                        <p>Processing time: 24-48 hours.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-bar">
            <div class="nav-item active" data-page="home">
                <i class="fas fa-home nav-icon"></i>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" data-page="earn">
                <i class="fas fa-coins nav-icon"></i>
                <div class="nav-label">Earn</div>
            </div>
            <div class="nav-item" data-page="task">
                <i class="fas fa-tasks nav-icon"></i>
                <div class="nav-label">Task</div>
            </div>
            <div class="nav-item" data-page="trade">
                <i class="fas fa-exchange-alt nav-icon"></i>
                <div class="nav-label">Trade</div>
            </div>
            <div class="nav-item" data-page="profile">
                <i class="fas fa-user nav-icon"></i>
                <div class="nav-label">Profile</div>
            </div>
        </div>
        
        <div class="notification" id="notification">
            <div id="notification-message">Notification message</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, serverTimestamp, query, where, getDocs, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyASMBf-fL9tJOj2sgKdpVK77TYRMga1bag",
            authDomain: "money-host-56ee9.firebaseapp.com",
            databaseURL: "https://money-host-56ee9-default-rtdb.firebaseio.com",
            projectId: "money-host-56ee9",
            storageBucket: "money-host-56ee9.firebasestorage.app",
            messagingSenderId: "701262930342",
            appId: "1:701262930342:web:a8c49ea25b730332ff2f67"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Admin user ID
        const ADMIN_USER_ID = "3jTr4Bc6bAbfBaMgJvBzniJPMWq1";
        
        // Global variables
        let currentUser = null;
        let userData = null;
        let appConfig = {};
        let botConfig = {};

        // --- NEW EXCHANGE RATES & MINIMUM WITHDRAWAL ---
        const MIN_WITHDRAWAL_USDT = 10;
        const MIN_REFERRALS_FOR_WITHDRAWAL = 15; // New constant
        const EXCHANGE_RATES = {
            BDT: 125, // 1 USDT = 125 BDT
            INR: 90   // 1 USDT = 90 INR
        };
        // ----------------------------------------------
        
        // Task links (will be loaded from Firebase, but defaults here are used)
        let taskLinks = {
            telegram: "https://t.me/Feeddy735",
            youtube: "https://youtube.com/@takaincome-w7z?si=xX7mjQHwIcqAUtvB",
            telegramBot: "http://t.me/bee_x_token_bot" // New Task Link as requested
        };
        
        // App state
        const state = {
            tokens: 0,
            usdt: 0,
            adsWatched: 0,
            tasksCompleted: 0,
            lastAirdrop: null,
            lastAdTime: null,
            completedTasks: [],
            referrals: 0,
            referralEarnings: 0,
            totalAvailableTasks: 3, // Updated to 3
            taskRewards: [50, 50, 200] // Updated rewards for tasks 1, 2, 3
        };
        
        // DOM Elements
        const appContainer = document.querySelector('.app-container');
        const splashScreen = document.getElementById('splash-screen');
        const authContainer = document.getElementById('auth-container');
        const loginView = document.getElementById('login-view');
        const signupView = document.getElementById('signup-view');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const signupName = document.getElementById('signup-name');
        const signupEmail = document.getElementById('signup-email');
        const signupPassword = document.getElementById('signup-password');
        const signupBtn = document.getElementById('signup-btn');
        const showSignup = document.getElementById('show-signup');
        const showLogin = document.getElementById('show-login');
        const skipAuth = document.getElementById('skip-auth');
        const referralCodeInput = document.getElementById('referral-code-input');
        // NEW MODAL DOM
        const telegramModal = document.getElementById('telegram-enforcement-modal');
        const openBotBtn = document.getElementById('open-telegram-bot-btn');
        
        const pages = {
            home: document.getElementById('home-page'),
            earn: document.getElementById('earn-page'),
            task: document.getElementById('task-page'),
            trade: document.getElementById('trade-page'),
            profile: document.getElementById('profile-page')
        };
        
        const navItems = document.querySelectorAll('.nav-item');
        const tokenCountEl = document.getElementById('token-count');
        const usdtValueEl = document.getElementById('usdt-value');
        const airdropButton = document.getElementById('claim-airdrop');
        const airdropCountdownEl = document.getElementById('airdrop-countdown');
        const watchAdButton = document.getElementById('watch-ad');
        const adCountdownEl = document.getElementById('ad-countdown');
        const adsWatchedEl = document.getElementById('ads-watched');
        const adProgressBar = document.getElementById('ad-progress-bar');
        const adProgressText = document.getElementById('ad-progress');
        const todayAdsEl = document.getElementById('today-ads');
        const tasksCompletedEl = document.getElementById('tasks-completed');
        const taskItems = document.querySelectorAll('.task-item');
        const beeAmountInput = document.getElementById('bee-amount');
        const usdtReceiveEl = document.getElementById('usdt-receive');
        const convertButton = document.getElementById('convert-tokens');
        const profileBeeEl = document.getElementById('profile-bee');
        const profileUsdtEl = document.getElementById('profile-usdt');
        const totalAdsEl = document.getElementById('total-ads');
        const totalTasksEl = document.getElementById('total-tasks');
        const withdrawButton = document.getElementById('withdraw-button');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        const referralCodeDisplay = document.getElementById('referral-code-display');
        const copyReferralBtn = document.getElementById('copy-referral-btn');
        const totalReferralsEl = document.getElementById('total-referrals');
        const referralEarningsEl = document.getElementById('referral-earnings');
        const profileReferralsEl = document.getElementById('profile-referrals');
        const telegramLinkText = document.getElementById('telegram-link-text');
        const youtubeLinkText = document.getElementById('youtube-link-text');
        // New Task DOM
        const botLinkText = document.getElementById('bot-link-text');
        // Withdrawal Warning DOM
        const withdrawalReferralWarning = document.getElementById('withdrawal-referral-warning');
        const currentReferralsCount = document.getElementById('current-referrals-count');

        // --- NEW WITHDRAWAL DOM ELEMENTS ---
        const withdrawalAmountInput = document.getElementById('withdrawal-amount');
        const withdrawalMethodSelect = document.getElementById('withdrawal-method');
        const accountDetailsInput = document.getElementById('account-details');
        const receiveAmountEl = document.getElementById('receive-amount');
        // -----------------------------------
        
        // Percentage buttons for trade
        document.getElementById('btn-25').addEventListener('click', () => setPercentage(25));
        document.getElementById('btn-50').addEventListener('click', () => setPercentage(50));
        document.getElementById('btn-75').addEventListener('click', () => setPercentage(75));
        document.getElementById('btn-100').addEventListener('click', () => setPercentage(100));
        
        // Authentication state change handler
        onAuthStateChanged(auth, handleAuthStateChange);

        // --- NEW WITHDRAWAL LOGIC LISTENERS ---
        withdrawalAmountInput.addEventListener('input', updateReceiveAmountDisplay);
        withdrawalMethodSelect.addEventListener('change', updateReceiveAmountDisplay);
        // --------------------------------------

        // --- TELEGRAM MODAL LISTENER (NEW) ---
        openBotBtn.addEventListener('click', () => {
            if (taskLinks.telegramBot) {
                // Open the link
                window.open(taskLinks.telegramBot, '_blank');
                
                // Remove the flag and hide the modal so the user can continue to the app
                localStorage.removeItem('needsBotRedirect');
                telegramModal.style.display = 'none';
            }
        });
        // -------------------------------------
        
        async function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                await fetchUserData();
                await fetchAppConfig();
                await fetchBotConfig();
                
                // Update task links from bot config
                updateTaskLinksUI();
                
                if (userData.isBlocked) {
                    showNotification("Your account has been blocked.");
                    await signOut(auth);
                    return;
                }
                
                // --- NEW REDIRECT LOGIC ---
                if (localStorage.getItem('needsBotRedirect') === 'true' && !userData.hasOpenedBot) {
                    // Force the modal display
                    authContainer.style.display = 'none';
                    appContainer.style.display = 'block';
                    telegramModal.style.display = 'flex';
                    // The rest of the app UI will be hidden by the modal
                } else {
                    // Regular login flow
                    updateUI();
                    authContainer.style.display = 'none';
                    appContainer.style.display = 'block';
                }
                // --- END NEW REDIRECT LOGIC ---

                // Setup real-time listeners
                setupRealtimeListeners();
            } else {
                currentUser = null;
                userData = null;
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        }
        
        function updateTaskLinksUI() {
             if (botConfig.telegramLink) {
                taskLinks.telegram = botConfig.telegramLink;
                telegramLinkText.textContent = `Click to join: ${botConfig.telegramLink.substring(0, 30)}...`;
            }
            if (botConfig.youtubeLink) {
                taskLinks.youtube = botConfig.youtubeLink;
                youtubeLinkText.textContent = `Click to subscribe: ${botConfig.youtubeLink.substring(0, 30)}...`;
            }
            if (botConfig.telegramBotLink) {
                 taskLinks.telegramBot = botConfig.telegramBotLink;
                 botLinkText.textContent = `Click to start: ${botConfig.telegramBotLink.substring(0, 30)}...`;
                 // Update the modal button link too
                 openBotBtn.dataset.link = taskLinks.telegramBot;
            }
            
            // Default to hardcoded link if not in config (for the new task)
            if (!botConfig.telegramBotLink) {
                botLinkText.textContent = `Click to start: ${taskLinks.telegramBot.substring(0, 30)}...`;
                openBotBtn.dataset.link = taskLinks.telegramBot;
            }

            // Update tasks completed count display on home page
            tasksCompletedEl.textContent = `${state.tasksCompleted}/${state.totalAvailableTasks}`;
        }

        async function fetchUserData() {
            if (!currentUser) return;
            
            const userRef = doc(db, "users", currentUser.uid);
            try {
                const userSnap = await getDoc(userRef);
                
                if (userSnap.exists()) {
                    userData = userSnap.data();
                    
                    // Check if daily reset is needed
                    const today = new Date().toISOString().split('T')[0];
                    if (userData.lastAdWatchDate !== today) {
                        await updateDoc(userRef, {
                            dailyAdCount: 0,
                            lastAdWatchDate: today
                        });
                        userData.dailyAdCount = 0;
                        userData.lastAdWatchDate = today;
                    }
                    
                    // Load state from user data
                    state.tokens = userData.balance || 0;
                    state.usdt = userData.usdtBalance || 0;
                    state.adsWatched = userData.totalAdsWatched || 0;
                    state.tasksCompleted = userData.completedTasks?.length || 0;
                    state.completedTasks = userData.completedTasks || [];
                    state.referrals = userData.referredUsers?.length || 0;
                    state.referralEarnings = userData.referralEarnings || 0;
                    
                    // Convert timestamps
                    state.lastAirdrop = userData.lastAirdrop ? userData.lastAirdrop.toDate() : null;
                    state.lastAdTime = userData.lastAdTime ? userData.lastAdTime.toDate() : null;
                    
                } else {
                    // Create new user
                    const ownReferralCode = generateReferralCode();
                    const defaultUserData = {
                        uid: currentUser.uid,
                        name: currentUser.displayName || currentUser.email.split('@')[0],
                        email: currentUser.email,
                        balance: 0,
                        usdtBalance: 0,
                        referralCode: ownReferralCode,
                        referredBy: null,
                        referredUsers: [],
                        referralEarnings: 0,
                        totalAdsWatched: 0,
                        dailyAdCount: 0,
                        lastAdWatchDate: new Date().toISOString().split('T')[0],
                        completedTasks: [],
                        lastAirdrop: null,
                        lastAdTime: null,
                        isBlocked: false,
                        hasOpenedBot: false, // NEW FIELD: Track if user has gone through the bot redirect
                        createdAt: serverTimestamp()
                    };
                    
                    await setDoc(userRef, defaultUserData);
                    userData = defaultUserData;
                    
                    // --- NEW REDIRECT LOGIC FOR NEW USER ---
                    localStorage.setItem('needsBotRedirect', 'true');
                    // ---------------------------------------
                    
                    // Check for referral code in URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const refCode = urlParams.get('ref');
                    
                    if (refCode) {
                        await applyReferralBonus(refCode);
                    }
                }
            } catch (error) {
                console.error("Error fetching user data:", error);
                showNotification("Error loading user data.");
            }
        }
        
        async function fetchAppConfig() {
            const configRef = doc(db, "config", "main");
            try {
                const configSnap = await getDoc(configRef);
                appConfig = configSnap.exists() ? configSnap.data() : { 
                    minWithdrawal: 20, // Keep default, but use local constant for enforcement
                    dailyAdLimit: 100,
                    coinValueCoins: 1000,
                    coinValueUsdt: 1
                };
            } catch (error) {
                console.error("Error fetching app config:", error);
            }
        }
        
        async function fetchBotConfig() {
            const configRef = doc(db, "config", "bot");
            try {
                const configSnap = await getDoc(configRef);
                botConfig = configSnap.exists() ? configSnap.data() : { 
                    telegramLink: taskLinks.telegram,
                    youtubeLink: taskLinks.youtube,
                    telegramBotLink: taskLinks.telegramBot, // Use the new task link here
                    botToken: "",
                    botUsername: ""
                };
            } catch (error) {
                console.error("Error fetching bot config:", error);
            }
        }
        
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        async function applyReferralBonus(referrerCode) {
            if (!currentUser || userData.referredBy) return;
            
            const usersRef = collection(db, "users");
            const q = query(usersRef, where("referralCode", "==", referrerCode));
            
            try {
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    const referrerDoc = querySnapshot.docs[0];
                    const referrerRef = doc(db, "users", referrerDoc.id);
                    const referrerData = referrerDoc.data();
                    
                    // Reward for referrer: 50 coins (as requested)
                    const referrerReward = 50; 
                    
                    // Update referrer's data
                    const newReferredUsers = [...(referrerData.referredUsers || []), currentUser.uid];
                    await updateDoc(referrerRef, {
                        referredUsers: newReferredUsers,
                        referralEarnings: (referrerData.referralEarnings || 0) + referrerReward
                    });
                    
                    // Update current user's data
                    const userRef = doc(db, "users", currentUser.uid);
                    // Giving the new user a 100 coin bonus (kept from original code)
                    const newUserBonus = 100; 
                    await updateDoc(userRef, {
                        referredBy: referrerCode,
                        balance: (userData.balance || 0) + newUserBonus
                    });
                    
                    // Update local state
                    userData.referredBy = referrerCode;
                    userData.balance += newUserBonus;
                    state.tokens += newUserBonus;
                    
                    // --- NEW REDIRECT LOGIC FOR REFERRAL USER ---
                    localStorage.setItem('needsBotRedirect', 'true');
                    // --------------------------------------------

                    showNotification("üéâ Referral bonus applied! You received 100 Bee Tokens.");
                    updateUI();
                }
            } catch(error) {
                console.error("Error applying referral bonus: ", error);
            }
        }
        
        function updateUI() {
            if (!userData) return;
            
            // Update token and USDT values
            tokenCountEl.textContent = state.tokens;
            const totalValue = state.usdt + (state.tokens * 0.001);
            usdtValueEl.textContent = `$${totalValue.toFixed(4)}`;
            profileBeeEl.textContent = state.tokens;
            profileUsdtEl.textContent = `$${state.usdt.toFixed(4)}`;
            
            // Update ad stats
            const dailyAds = userData.dailyAdCount || 0;
            adsWatchedEl.textContent = dailyAds;
            todayAdsEl.textContent = `${dailyAds}/${appConfig.dailyAdLimit || 100}`;
            totalAdsEl.textContent = state.adsWatched;
            
            // Update task stats (tasksCompleted is now max 3)
            tasksCompletedEl.textContent = `${state.completedTasks.length}/${state.totalAvailableTasks}`;
            totalTasksEl.textContent = state.tasksCompleted;
            
            // Update referral stats
            const referrals = userData.referredUsers?.length || 0;
            const referralEarnings = userData.referralEarnings || 0;
            totalReferralsEl.textContent = referrals;
            referralEarningsEl.textContent = referralEarnings;
            profileReferralsEl.textContent = referrals;
            referralCodeDisplay.textContent = userData.referralCode || "BEE2024";
            
            // Update ad progress
            const progress = Math.min((dailyAds / (appConfig.dailyAdLimit || 100)) * 100, 100);
            adProgressBar.style.width = `${progress}%`;
            adProgressText.textContent = `${Math.round(progress)}%`;
            
            // Update completed tasks UI (Task 1: index 0, Task 2: index 1, Task 3: index 2)
            const allTaskItems = document.querySelectorAll('#task-page .task-item');
            allTaskItems.forEach((item, index) => {
                if (state.completedTasks.includes(index)) {
                    item.style.opacity = '0.7';
                    item.querySelector('.reward-badge').textContent = `Claimed (${state.taskRewards[index]})`;
                    item.querySelector('.reward-badge').style.backgroundColor = '#4CAF50';
                } else {
                    item.style.opacity = '1';
                    item.querySelector('.reward-badge').textContent = `+${state.taskRewards[index]} Tokens`;
                    item.querySelector('.reward-badge').style.backgroundColor = 'var(--dark-yellow)';
                }
            });
            
            // Update trade page balance
            document.getElementById('bee-balance-trade').textContent = state.tokens;
            
            // Update USDT receive amount
            updateUsdtReceive();

            // Update withdrawal form and check referral lock
            withdrawalAmountInput.setAttribute('max', state.usdt.toFixed(2));
            updateWithdrawalLockUI(); // NEW: Check and update lock UI
            updateReceiveAmountDisplay();
            
            // Update profile name
            document.getElementById('profile-user-name').textContent = userData.name || 'Guest Bee';
        }
        
        function updateWithdrawalLockUI() {
            const referrals = userData.referredUsers?.length || 0;
            const usdtBalance = state.usdt;
            
            // Check only for referral lock and balance lock (for button)
            const isReferralLocked = referrals < MIN_REFERRALS_FOR_WITHDRAWAL;
            const isBalanceLocked = usdtBalance < MIN_WITHDRAWAL_USDT;
            const isLocked = isReferralLocked || isBalanceLocked;

            currentReferralsCount.textContent = `${referrals}/${MIN_REFERRALS_FOR_WITHDRAWAL}`;
            
            // **New Logic: Only control the button and the warning message**
            
            // 1. Warning Message
            if (isReferralLocked) {
                withdrawalReferralWarning.style.display = 'block';
                withdrawalReferralWarning.innerHTML = `
                    <p>‚ö†Ô∏è **Withdrawal Lock** ‚ö†Ô∏è</p>
                    <p>You need **${MIN_REFERRALS_FOR_WITHDRAWAL} Referrals** to unlock the **Withdraw** button. You currently have: <span id="current-referrals-count-inner">${referrals}</span></p>
                `;
                 // Update the inner span just in case
                const innerCount = document.getElementById('current-referrals-count-inner');
                if(innerCount) innerCount.textContent = `${referrals}/${MIN_REFERRALS_FOR_WITHDRAWAL}`;
            } else {
                withdrawalReferralWarning.style.display = 'none';
            }

            // 2. Withdrawal Button (Disable if EITHER referral OR balance is low)
            withdrawButton.disabled = isLocked;
            
            if (isReferralLocked) {
                withdrawButton.innerHTML = `<i class="fas fa-lock"></i> ${MIN_REFERRALS_FOR_WITHDRAWAL} Referrals Needed`;
            } else if (isBalanceLocked) {
                withdrawButton.innerHTML = `<i class="fas fa-lock"></i> Min. ${MIN_WITHDRAWAL_USDT} USDT Needed`;
            } else {
                 withdrawButton.innerHTML = '<i class="fas fa-wallet"></i> Submit Withdrawal Request';
            }
            
            // 3. Form fields remain ENABLED (the user's request)
            withdrawalAmountInput.disabled = false;
            withdrawalMethodSelect.disabled = false;
            accountDetailsInput.disabled = false;
        }
        
        function updateUsdtReceive() {
            const beeAmount = parseInt(beeAmountInput.value) || 0;
            const usdtAmount = beeAmount * 0.001;
            usdtReceiveEl.textContent = usdtAmount.toFixed(4) + ' USDT';
        }
        
        function updateReceiveAmountDisplay() {
            let usdtAmount = parseFloat(withdrawalAmountInput.value) || 0;
            const method = withdrawalMethodSelect.value;
            let displayText = '';

            // Enforce minimum withdrawal on display
            if (usdtAmount < MIN_WITHDRAWAL_USDT) {
                receiveAmountEl.textContent = `Min. ${MIN_WITHDRAWAL_USDT} USDT required.`;
                receiveAmountEl.style.color = 'var(--red)';
                return;
            } else {
                receiveAmountEl.style.color = 'var(--black)';
            }

            switch (method) {
                case 'Binance':
                    displayText = `${usdtAmount.toFixed(2)} USDT`;
                    break;
                case 'bKash':
                case 'Nagad':
                    const bdtAmount = usdtAmount * EXCHANGE_RATES.BDT;
                    displayText = `${bdtAmount.toFixed(2)} BDT (1 USDT = ${EXCHANGE_RATES.BDT} BDT)`;
                    break;
                case 'PayPal':
                    const inrAmount = usdtAmount * EXCHANGE_RATES.INR;
                    displayText = `${inrAmount.toFixed(2)} INR (1 USDT = ${EXCHANGE_RATES.INR} INR)`;
                    break;
                default:
                    displayText = `${usdtAmount.toFixed(2)} USDT`;
            }

            receiveAmountEl.textContent = displayText;
        }

        function setPercentage(percent) {
            const amount = Math.floor((state.tokens * percent) / 100);
            beeAmountInput.value = amount;
            updateUsdtReceive();
        }
        
        function showNotification(message, duration = 3000) {
            notificationMessage.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }
        
        function setupRealtimeListeners() {
            if (!currentUser) return;
            
            // Listen for user data changes
            const userRef = doc(db, "users", currentUser.uid);
            onSnapshot(userRef, (doc) => {
                if (doc.exists()) {
                    const newUserData = doc.data();
                    
                    // Check if the user has completed the bot opening step
                    if (newUserData.hasOpenedBot && localStorage.getItem('needsBotRedirect') === 'true') {
                         localStorage.removeItem('needsBotRedirect');
                         telegramModal.style.display = 'none';
                         showNotification("üéâ Setup Complete! Welcome to the app!");
                    }
                    
                    userData = newUserData;
                    
                    // Update state from new data
                    state.tokens = userData.balance || 0;
                    state.usdt = userData.usdtBalance || 0;
                    state.adsWatched = userData.totalAdsWatched || 0;
                    state.tasksCompleted = userData.completedTasks?.length || 0;
                    state.completedTasks = userData.completedTasks || [];
                    state.referrals = userData.referredUsers?.length || 0;
                    state.referralEarnings = userData.referralEarnings || 0;
                    
                    updateUI();
                }
            });
            
            // Listen for bot config changes
            const botConfigRef = doc(db, "config", "bot");
            onSnapshot(botConfigRef, (doc) => {
                if (doc.exists()) {
                    botConfig = doc.data();
                    updateTaskLinksUI(); // Update UI for new links
                }
            });
        }
        
        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                // Prevent navigation if the modal is visible (enforcement)
                if (telegramModal.style.display === 'flex') {
                    showNotification("Please open the Telegram Mini App first!");
                    return;
                }
                
                const page = item.getAttribute('data-page');
                
                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                
                // Show selected page
                Object.values(pages).forEach(p => p.classList.remove('active'));
                pages[page].classList.add('active');
            });
        });
        
        // Authentication event listeners
        showSignup.addEventListener('click', () => {
            loginView.style.display = 'none';
            signupView.style.display = 'block';
        });
        
        showLogin.addEventListener('click', () => {
            signupView.style.display = 'none';
            loginView.style.display = 'block';
        });
        
        skipAuth.addEventListener('click', () => {
            // Create anonymous account
            const tempEmail = `guest_${Date.now()}@beetoken.com`;
            const tempPassword = `guest_${Math.random().toString(36).substring(2)}`;
            
            createUserWithEmailAndPassword(auth, tempEmail, tempPassword)
                .catch(error => {
                    // If user already exists, try login
                    signInWithEmailAndPassword(auth, tempEmail, tempPassword);
                });
        });
        
        loginBtn.addEventListener('click', async () => {
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            if (!email || !password) {
                showNotification("Please enter email and password.");
                return;
            }
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showNotification("Login successful!");
            } catch (error) {
                showNotification("Login failed: " + error.message);
            }
        });
        
        signupBtn.addEventListener('click', async () => {
            const name = signupName.value;
            const email = signupEmail.value;
            const password = signupPassword.value;
            const referralCode = referralCodeInput.value.trim().toUpperCase();
            
            if (!name || !email || !password) {
                showNotification("Please fill all required fields.");
                return;
            }
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Store referral code to apply after user creation
                if (referralCode) {
                    localStorage.setItem('pendingReferralCode', referralCode);
                }
                
                showNotification("Account created successfully!");
            } catch (error) {
                showNotification("Signup failed: " + error.message);
            }
        });
        
        // Daily Tap functionality
        airdropButton.addEventListener('click', async () => {
            if (!currentUser) return;
            // CHECK MODAL
            if (telegramModal.style.display === 'flex') {
                showNotification("Please open the Telegram Mini App first!");
                return;
            }
            
            const now = new Date();
            
            // Check if 24 hours have passed since last tap
            if (userData.lastAirdrop) {
                const timeDiff = now - userData.lastAirdrop.toDate();
                const hoursDiff = timeDiff / (1000 * 60 * 60);
                
                if (hoursDiff < 24) {
                    const remainingHours = 24 - hoursDiff;
                    const hours = Math.floor(remainingHours);
                    const minutes = Math.floor((remainingHours - hours) * 60);
                    const seconds = Math.floor(((remainingHours - hours) * 60 - minutes) * 60);
                    
                    showNotification(`Come back in ${hours}h ${minutes}m ${seconds}s to tap again!`);
                    return;
                }
            }
            
            // Claim airdrop
            const reward = 50;
            const userRef = doc(db, "users", currentUser.uid);
            
            try {
                await updateDoc(userRef, {
                    balance: (userData.balance || 0) + reward,
                    lastAirdrop: serverTimestamp()
                });
                
                // Update local state
                userData.balance = (userData.balance || 0) + reward;
                state.tokens += reward;
                userData.lastAirdrop = now;
                
                showNotification(`üéâ You tapped and claimed ${reward} Bee Tokens!`);
                updateUI();
            } catch (error) {
                showNotification("Error claiming airdrop: " + error.message);
            }
        });
        
        // Watch ad functionality
        watchAdButton.addEventListener('click', async () => {
            if (!currentUser) return;
            // CHECK MODAL
            if (telegramModal.style.display === 'flex') {
                showNotification("Please open the Telegram Mini App first!");
                return;
            }
            
            // Check daily limit
            const dailyAds = userData.dailyAdCount || 0;
            if (dailyAds >= (appConfig.dailyAdLimit || 100)) {
                showNotification('You have reached the daily limit of ads. Come back tomorrow!');
                return;
            }
            
            // Check hourly limit (50 per hour)
            const now = new Date();
            if (userData.lastAdTime) {
                const timeDiff = now - userData.lastAdTime.toDate();
                const minutesDiff = timeDiff / (1000 * 60);
                
                // If less than an hour has passed and user watched 50 ads in that hour
                if (minutesDiff < 60 && dailyAds % 50 === 0 && dailyAds > 0) {
                    const remainingMinutes = 60 - minutesDiff;
                    showNotification(`Hourly limit reached. Wait ${Math.ceil(remainingMinutes)} minutes before watching more ads.`);
                    return;
                }
            }
            
            // DOM element for Ad Display
            const currentAdDisplay = document.getElementById('current-ad');
            
            // --- GIGAPUB AD DISPLAY LOGIC START ---
            if (window.showGiga) {
                watchAdButton.disabled = true;
                watchAdButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading Ad...';
                
                window.showGiga()
                    .then(async () => {
                        // Reward user on successful ad view/close
                        const reward = 10;
                        const userRef = doc(db, "users", currentUser.uid);
                        
                        try {
                            await updateDoc(userRef, {
                                balance: (userData.balance || 0) + reward,
                                totalAdsWatched: (userData.totalAdsWatched || 0) + 1,
                                dailyAdCount: (userData.dailyAdCount || 0) + 1,
                                lastAdTime: serverTimestamp()
                            });
                            
                            // Update local state
                            userData.balance = (userData.balance || 0) + reward;
                            userData.totalAdsWatched = (userData.totalAdsWatched || 0) + 1;
                            userData.dailyAdCount = (userData.dailyAdCount || 0) + 1;
                            state.tokens += reward;
                            state.adsWatched = userData.totalAdsWatched;
                            
                            // Update ad display
                            currentAdDisplay.innerHTML = `
                                <i class="fas fa-check-circle" style="color: var(--green); font-size: 40px;"></i>
                                <p style="margin-top: 10px;">Ad completed!</p>
                                <p style="font-size: 14px; margin-top: 5px; color: var(--green);">+${reward} Bee Tokens</p>
                            `;
                            
                            showNotification(`‚úÖ Ad watched! You earned ${reward} Bee Tokens.`);
                            updateUI();
                            
                            // Reset button after a short delay
                            setTimeout(() => {
                                watchAdButton.disabled = false;
                                watchAdButton.innerHTML = '<i class="fas fa-play-circle"></i> Watch Ad & Earn 10 Tokens';
                                currentAdDisplay.innerHTML = `
                                    <i class="fas fa-video" style="font-size: 40px; color: var(--blue);"></i>
                                    <p style="margin-top: 10px;">Ready to watch an ad!</p>
                                    <p id="ad-timer" style="font-size: 12px; margin-top: 5px;"></p>
                                `;
                            }, 2000);
                        } catch (error) {
                            showNotification("Error updating balance: " + error.message);
                        }
                    })
                    .catch(e => {
                        console.error('Gigapub Ad Error:', e);
                        showNotification('‚ùå Ad failed to load or was closed early. Try again.');
                        
                        setTimeout(() => {
                            watchAdButton.disabled = false;
                            watchAdButton.innerHTML = '<i class="fas fa-play-circle"></i> Watch Ad & Earn 10 Tokens';
                        }, 1000);
                    });
            } else {
                // Fallback for demo/simulation
                showNotification('Ad network not initialized. Simulating reward in 5s...');
                
                let countdown = 5;
                const adTimer = document.getElementById('ad-timer');
                adTimer.textContent = `Simulating reward in ${countdown}s`;
                adTimer.style.color = 'var(--red)';

                watchAdButton.disabled = true;
                watchAdButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Simulating Ad...';
                
                const countdownInterval = setInterval(async () => {
                    countdown--;
                    adTimer.textContent = `Simulating reward in ${countdown}s`;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        
                        // Reward user
                        const reward = 10;
                        const userRef = doc(db, "users", currentUser.uid);
                        
                        try {
                            await updateDoc(userRef, {
                                balance: (userData.balance || 0) + reward,
                                totalAdsWatched: (userData.totalAdsWatched || 0) + 1,
                                dailyAdCount: (userData.dailyAdCount || 0) + 1,
                                lastAdTime: serverTimestamp()
                            });
                            
                            // Update local state
                            userData.balance = (userData.balance || 0) + reward;
                            userData.totalAdsWatched = (userData.totalAdsWatched || 0) + 1;
                            userData.dailyAdCount = (userData.dailyAdCount || 0) + 1;
                            state.tokens += reward;
                            state.adsWatched = userData.totalAdsWatched;
                            
                            // Update ad display
                            currentAdDisplay.innerHTML = `
                                <i class="fas fa-check-circle" style="color: var(--green); font-size: 40px;"></i>
                                <p style="margin-top: 10px;">Ad completed!</p>
                                <p style="font-size: 14px; margin-top: 5px; color: var(--green);">+${reward} Bee Tokens</p>
                            `;
                            
                            showNotification(`‚úÖ Ad watched! You earned ${reward} Bee Tokens.`);
                            updateUI();
                            
                            // Reset button after a short delay
                            setTimeout(() => {
                                watchAdButton.disabled = false;
                                watchAdButton.innerHTML = '<i class="fas fa-play-circle"></i> Watch Ad & Earn 10 Tokens';
                                currentAdDisplay.innerHTML = `
                                    <i class="fas fa-video" style="font-size: 40px; color: var(--blue);"></i>
                                    <p style="margin-top: 10px;">Ready to watch an ad!</p>
                                    <p id="ad-timer" style="font-size: 12px; margin-top: 5px;"></p>
                                `;
                            }, 2000);
                        } catch (error) {
                            showNotification("Error updating balance: " + error.message);
                        }
                    }
                }, 1000);
            }
            // --- GIGAPUB AD DISPLAY LOGIC END ---
        });
        
        // Task completion
        taskItems.forEach((item, index) => {
            item.addEventListener('click', async () => {
                if (!currentUser) return;
                // CHECK MODAL
                if (telegramModal.style.display === 'flex') {
                    showNotification("Please open the Telegram Mini App first!");
                    return;
                }
                
                const taskIndex = index;
                const reward = state.taskRewards[taskIndex]; // Get reward from state
                let link = '';

                // Determine the correct link based on task index
                if (taskIndex === 0) link = taskLinks.telegram;
                else if (taskIndex === 1) link = taskLinks.youtube;
                else if (taskIndex === 2) {
                     link = taskLinks.telegramBot;
                     // Set the hasOpenedBot flag on first click of the bot task
                     if (!state.completedTasks.includes(taskIndex)) {
                          const userRef = doc(db, "users", currentUser.uid);
                          await updateDoc(userRef, { hasOpenedBot: true });
                     }
                }
                
                // Always open the link
                window.open(link, '_blank');
                
                // Only claim token once
                if (state.completedTasks.includes(taskIndex)) {
                    showNotification('You have already claimed the reward for this task!');
                    return;
                }
                
                // Claim reward
                const userRef = doc(db, "users", currentUser.uid);
                const updatedTasks = [...state.completedTasks, taskIndex];
                
                try {
                    await updateDoc(userRef, {
                        balance: (userData.balance || 0) + reward,
                        completedTasks: updatedTasks
                    });
                    
                    // Update local state
                    userData.balance = (userData.balance || 0) + reward;
                    state.tokens += reward;
                    state.completedTasks = updatedTasks;
                    state.tasksCompleted = updatedTasks.length;
                    
                    showNotification(`üéâ Claimed ${reward} Bee Tokens! Task ${taskIndex + 1} completed.`);
                    updateUI();
                } catch (error) {
                    showNotification("Error claiming task reward: " + error.message);
                }
            });
        });
        
        // Convert tokens to USDT
        convertButton.addEventListener('click', async () => {
            if (!currentUser) return;
            // CHECK MODAL
            if (telegramModal.style.display === 'flex') {
                showNotification("Please open the Telegram Mini App first!");
                return;
            }
            
            const beeAmount = parseInt(beeAmountInput.value) || 0;
            
            if (beeAmount < 100) {
                showNotification('Minimum conversion amount is 100 Bee Tokens.');
                return;
            }
            
            if (beeAmount > state.tokens) {
                showNotification('Insufficient Bee Tokens.');
                return;
            }
            
            const usdtAmount = beeAmount * 0.001;
            const userRef = doc(db, "users", currentUser.uid);
            
            try {
                await updateDoc(userRef, {
                    balance: (userData.balance || 0) - beeAmount,
                    usdtBalance: (userData.usdtBalance || 0) + usdtAmount
                });
                
                // Update local state
                userData.balance = (userData.balance || 0) - beeAmount;
                userData.usdtBalance = (userData.usdtBalance || 0) + usdtAmount;
                state.tokens = userData.balance;
                state.usdt = userData.usdtBalance;
                
                showNotification(`‚úÖ Converted ${beeAmount} BEE to ${usdtAmount.toFixed(4)} USDT`);
                beeAmountInput.value = 0;
                updateUI();
            } catch (error) {
                showNotification("Error converting tokens: " + error.message);
            }
        });
        
        // Copy referral link
        copyReferralBtn.addEventListener('click', () => {
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${userData.referralCode}`;
            
            navigator.clipboard.writeText(referralLink)
                .then(() => {
                    showNotification('Referral link copied to clipboard!');
                })
                .catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = referralLink;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('Referral link copied!');
                });
        });
        
        // Withdraw functionality
        withdrawButton.addEventListener('click', async () => {
            if (!currentUser) return;
            // CHECK MODAL
            if (telegramModal.style.display === 'flex') {
                showNotification("Please open the Telegram Mini App first!");
                return;
            }
            
            // --- FINAL LOCK CHECK ---
            const referrals = userData.referredUsers?.length || 0;
            const usdtAmount = parseFloat(withdrawalAmountInput.value);
            const usdtBalance = state.usdt;
            
            if (referrals < MIN_REFERRALS_FOR_WITHDRAWAL) {
                showNotification(`Withdrawal requires ${MIN_REFERRALS_FOR_WITHDRAWAL} referrals. You currently have ${referrals}.`);
                return;
            }

            if (usdtAmount < MIN_WITHDRAWAL_USDT) {
                showNotification(`Minimum withdrawal is ${MIN_WITHDRAWAL_USDT} USDT.`);
                return;
            }
            
            if (usdtAmount > usdtBalance) {
                showNotification('Insufficient USDT balance for this withdrawal.');
                return;
            }
            // --------------------------

            const method = withdrawalMethodSelect.value;
            const accountDetails = accountDetailsInput.value.trim();


            if (!accountDetails) {
                showNotification('Please enter your account number/ID for the selected method.');
                return;
            }
            
            // Calculate equivalent receive amount for the withdrawal record
            let receiveValue = usdtAmount.toFixed(2);
            let receiveCurrency = 'USDT';
            
            if (method === 'bKash' || method === 'Nagad') {
                receiveValue = (usdtAmount * EXCHANGE_RATES.BDT).toFixed(2);
                receiveCurrency = 'BDT';
            } else if (method === 'PayPal') {
                receiveValue = (usdtAmount * EXCHANGE_RATES.INR).toFixed(2);
                receiveCurrency = 'INR';
            }

            // Create withdrawal request
            try {
                // Deduct USDT first
                const userRef = doc(db, "users", currentUser.uid);
                await updateDoc(userRef, {
                    usdtBalance: (userData.usdtBalance || 0) - usdtAmount
                });

                // Update local state
                userData.usdtBalance -= usdtAmount;
                state.usdt = userData.usdtBalance;
                
                // Add withdrawal request to the 'withdrawals' collection
                await addDoc(collection(db, "withdrawals"), {
                    userId: currentUser.uid,
                    userName: userData.name,
                    userEmail: userData.email,
                    usdtAmount: usdtAmount,
                    method: method,
                    accountDetail: accountDetails,
                    receiveValue: receiveValue,
                    receiveCurrency: receiveCurrency,
                    status: "pending",
                    requestedAt: serverTimestamp()
                });

                updateUI(); // Reflect the deducted balance immediately
                
                showNotification(`‚úÖ Withdrawal request submitted successfully! Amount: ${usdtAmount.toFixed(2)} USDT via ${method}.`, 4000);
            } catch (error) {
                showNotification('Error submitting withdrawal request: ' + error.message);
            }
        });
        
        // Update countdowns
        function updateCountdowns() {
            if (!userData) return;
            
            // Daily tap countdown
            if (userData.lastAirdrop) {
                const now = new Date();
                const timeDiff = now - userData.lastAirdrop.toDate();
                const hoursDiff = timeDiff / (1000 * 60 * 60);
                
                if (hoursDiff < 24) {
                    const remainingHours = 24 - hoursDiff;
                    const hours = Math.floor(remainingHours);
                    const minutes = Math.floor((remainingHours - hours) * 60);
                    const seconds = Math.floor(((remainingHours - hours) * 60 - minutes) * 60);
                    
                    airdropCountdownEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    airdropButton.disabled = true;
                    airdropButton.innerHTML = '<i class="fas fa-clock"></i> Tap Cooldown';
                } else {
                    airdropCountdownEl.textContent = '24:00:00';
                    airdropButton.disabled = false;
                    airdropButton.innerHTML = '<i class="fas fa-hand-point-up"></i> Tap for 50 Bee Tokens';
                }
            }
            
            // Ad countdown
            if (userData.lastAdTime) {
                const now = new Date();
                const timeDiff = now - userData.lastAdTime.toDate();
                const secondsDiff = timeDiff / 1000;
                
                // 10-second cooldown between ads
                if (secondsDiff < 10) {
                    const remainingSeconds = 10 - Math.floor(secondsDiff);
                    adCountdownEl.textContent = `${remainingSeconds}s`;
                    watchAdButton.disabled = true;
                    return;
                }
                
                // Check hourly limit
                const minutesDiff = timeDiff / (1000 * 60);
                const dailyAds = userData.dailyAdCount || 0;
                if (minutesDiff < 60 && dailyAds % 50 === 0 && dailyAds > 0) {
                    const remainingMinutes = 60 - minutesDiff;
                    adCountdownEl.textContent = `${Math.ceil(remainingMinutes)}m`;
                    watchAdButton.disabled = true;
                    return;
                }
            }
            
            adCountdownEl.textContent = '0s';
            watchAdButton.disabled = (userData.dailyAdCount || 0) >= (appConfig.dailyAdLimit || 100);
        }
        
        // Initialize app
        function initApp() {
            // Hide splash screen
            splashScreen.style.display = 'none';
            
            // Check if user is already logged in
            if (auth.currentUser) {
                authContainer.style.display = 'none';
                appContainer.style.display = 'block';
                // handleAuthStateChange will take care of showing the modal if needed
            } else {
                authContainer.style.display = 'flex';
            }
            
            // Update countdowns every second
            setInterval(updateCountdowns, 1000);
            
            // Show welcome message
            setTimeout(() => {
                showNotification('üêù Welcome to Bee Token! Start earning crypto today!');
            }, 500);
        }
        
        // Start the app with a 5-second delay for the splash screen
        setTimeout(initApp, 5000);
        
        // Make functions available globally
        window.updateUsdtReceive = updateUsdtReceive;
        window.setPercentage = setPercentage;
        window.showNotification = showNotification;
        window.updateReceiveAmountDisplay = updateReceiveAmountDisplay; // Export new function
    </script>

    <script data-project-id="4790">
      !function(){
        var s=document.currentScript,p=s.getAttribute('data-project-id')||'default';
        var d=['https://ad.gigapub.tech','https://ru-ad.gigapub.tech'],i=0,t,sc;
        function l(){
          sc=document.createElement('script');
          sc.async=true;
          sc.src=d[i]+'/script?id='+p;
          clearTimeout(t);
          t=setTimeout(function(){
            sc.onload=sc.onerror=null;
            sc.src='';
            if(++i<d.length)l();
          },15000);
          sc.onload=function(){clearTimeout(t)};
          sc.onerror=function(){clearTimeout(t);if(++i<d.length)l()};
          document.head.appendChild(sc);
        }
        l();
      }();
    </script>
</body>
</html>
